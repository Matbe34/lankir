<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' wails:; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' wails:; font-src 'self';">
    <title>PDF App</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app" class="flex flex-col h-screen" role="application" aria-label="PDF Editor Application">
        <header class="flex justify-between items-center px-4 py-3 bg-bg-secondary border-b border-border-color" role="banner">
            <div class="flex gap-2">
                <button id="openBtn"
                    class="px-4 py-2 rounded-md bg-accent-blue text-text-primary cursor-pointer text-sm flex items-center gap-2 transition-colors hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                    aria-label="Open PDF file"
                    title="Open a PDF document (Ctrl+O)">
                    <span aria-hidden="true">üìÇ</span> Open PDF
                </button>
                <button id="settingsBtn" class="btn" aria-label="Open settings" title="Configure application settings">
                    <span aria-hidden="true">‚öôÔ∏è</span> Settings
                </button>
            </div>
            <div>
                <h1 class="text-xl font-bold">PDF App</h1>
            </div>
            <div class="flex gap-2">
                <button id="signBtn" class="btn btn-primary" disabled aria-label="Sign PDF" title="Digitally sign the PDF document (Alt+S)">
                    <span aria-hidden="true">üîí</span> Sign
                </button>
            </div>
        </header>

        <div class="flex bg-bg-secondary border-b border-border-color overflow-x-auto min-h-0 max-h-0 opacity-0 transition-all has-tabs:min-h-10 has-tabs:max-h-10 has-tabs:opacity-100 scrollbar-thin"
            id="pdfTabsContainer" role="tablist" aria-label="Open PDF documents">
            <div class="pdf-tab active" id="homeTab" role="tab" aria-selected="true" aria-controls="pdfViewer">
                <span class="pdf-tab-name"><span aria-hidden="true">üè†</span> Home</span>
            </div>
            <!-- PDF tabs will be dynamically added here -->
        </div>

        <main class="flex flex-1 overflow-hidden relative">
            <div class="flex flex-col bg-bg-secondary border-r border-border-color w-64 transition-all left-sidebar"
                id="leftSidebar">
                <div class="flex justify-between items-center bg-bg-tertiary border-b border-border-color">
                    <div class="flex flex-1">
                        <button
                            class="tab-btn flex-1 px-2 py-3 border-none bg-transparent text-text-secondary cursor-pointer text-sm font-medium border-b-2 border-transparent transition-all hover:bg-hover-color hover:text-text-primary active"
                            data-tab="pages">Pages</button>
                        <button
                            class="tab-btn flex-1 px-2 py-3 border-none bg-transparent text-text-secondary cursor-pointer text-sm font-medium border-b-2 border-transparent transition-all hover:bg-hover-color hover:text-text-primary"
                            data-tab="index">Index</button>
                        <button
                            class="tab-btn flex-1 px-2 py-3 border-none bg-transparent text-text-secondary cursor-pointer text-sm font-medium border-b-2 border-transparent transition-all hover:bg-hover-color hover:text-text-primary"
                            data-tab="comments">Comments</button>
                    </div>
                    <button
                        class="px-2 py-2 bg-transparent border-none text-text-secondary cursor-pointer text-base transition-all hover:text-text-primary hover:bg-hover-color"
                        id="collapseLeft" title="Hide sidebar">&lt;</button>
                </div>

                <div class="tab-content active" id="pagesTab">
                    <div id="pageList" class="flex-1 overflow-y-auto p-2">
                        <div class="flex items-center justify-center h-full text-text-secondary text-sm">
                            <p>No PDF loaded</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="indexTab">
                    <div class="flex-1 overflow-y-auto p-4">
                        <div class="flex items-center justify-center h-full text-text-secondary text-sm">
                            <p>No index available</p>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="commentsTab">
                    <div class="flex-1 overflow-y-auto p-4">
                        <div class="flex items-center justify-center h-full text-text-secondary text-sm">
                            <p>No comments yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <button
                class="expand-btn left-expand-btn absolute top-2 left-0 px-2 py-3 bg-bg-secondary border border-border-color border-l-0 rounded-r text-text-secondary cursor-pointer text-base z-10 transition-all hover:text-text-primary hover:bg-bg-tertiary hidden"
                id="expandLeft" title="Show sidebar">&gt;</button>

            <div class="flex-1 bg-bg-primary overflow-hidden flex flex-col">
                <div id="pdfViewer" class="pdf-viewer">
                    <div class="welcome-screen">
                        <div class="welcome-content">
                            <h2>Welcome to PDF App</h2>
                            <p>A modern, high-performance PDF editor for Linux</p>
                            <p>Use Ctrl+o or the button in the taskbar to open a PDF.</p>

                            <div class="recent-files-welcome" id="recentFilesWelcome">
                                <h3>Recent Files</h3>
                                <div id="recentFilesGrid" class="recent-files-grid">
                                    <div class="empty-state">
                                        <p>No recent files</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button
                class="expand-btn right-expand-btn absolute top-2 right-0 px-2 py-3 bg-bg-secondary border border-border-color border-r-0 rounded-l text-text-secondary cursor-pointer text-base z-10 transition-all hover:text-text-primary hover:bg-bg-tertiary hidden"
                id="expandRight" title="Show properties">&lt;</button>

            <div class="flex flex-col bg-bg-secondary border-l border-border-color w-64 transition-all right-sidebar"
                id="rightSidebar">
                <div class="flex justify-between items-center p-4 border-b border-border-color">
                    <h3 class="text-sm font-semibold uppercase text-text-secondary">Properties</h3>
                    <button
                        class="px-2 py-2 bg-transparent border-none text-text-secondary cursor-pointer text-base transition-all hover:text-text-primary hover:bg-hover-color"
                        id="collapseRight" title="Hide properties">&gt;</button>
                </div>
                <div id="properties" class="p-4">
                    <div class="mb-4">
                        <label class="block text-xs font-semibold uppercase text-text-secondary mb-1">File:</label>
                        <span id="fileName" class="block text-sm text-text-primary">-</span>
                    </div>
                    <div class="mb-4">
                        <label class="block text-xs font-semibold uppercase text-text-secondary mb-1">Pages:</label>
                        <span id="pageCount" class="block text-sm text-text-primary">-</span>
                    </div>

                    <!-- Signature Information -->
                    <div class="mt-6 pt-4 border-t border-border-color">
                        <h4 class="text-sm font-semibold text-text-primary mb-4">Digital Signatures</h4>
                        <div id="signatureInfo" class="text-sm">
                            <div class="flex items-center justify-center h-full text-text-secondary text-sm py-4">
                                <p>No signature information</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer
            class="flex justify-between items-center px-4 py-2 bg-bg-secondary border-t border-border-color text-xs text-text-secondary"
            role="contentinfo">
            <div class="flex items-center gap-2">
                <span id="statusText" role="status" aria-live="polite" aria-atomic="true">Ready</span>
            </div>
            <div class="flex items-center gap-3">
                <span id="pageIndicator">-</span>
                <span class="text-border-color">‚Ä¢</span>
                <span id="scrollProgress">-</span>
            </div>
            <div class="flex items-center gap-2">
                <button id="zoomOutBtn" class="btn-icon" title="Zoom out">-</button>
                <input type="text" id="zoomInput" class="zoom-input" value="100">
                <span class="text-text-secondary text-xs">%</span>
                <button id="zoomInBtn" class="btn-icon" title="Zoom in">+</button>
            </div>
        </footer>
    </div>

    <!-- Profile Selection Dialog -->
    <div id="profileDialog" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="profileDialogTitle">
        <div class="modal">
            <div class="modal-header">
                <h2 id="profileDialogTitle">Choose Signature Type</h2>
                <button class="modal-close" id="profileDialogClose" aria-label="Close dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-selection-section">
                    <label for="profileSelectMain">Signature Profile:</label>
                    <select id="profileSelectMain" class="profile-select">
                        <option value="">Loading...</option>
                    </select>
                    <p id="profileDescriptionMain" class="profile-description"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="profileDialogCancel" class="btn">Cancel</button>
                <button id="profileDialogNext" class="btn btn-primary">Next</button>
            </div>
        </div>
    </div>

    <!-- Certificate Selection Dialog -->
    <div id="certDialog" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="certDialogTitle">
        <div class="modal">
            <div class="modal-header">
                <h2 id="certDialogTitle">Select Certificate for Signing</h2>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button class="modal-refresh" id="certDialogRefresh" title="Refresh certificate list">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M14 2v4h-4M2 14v-4h4M14.2 6c-.4-1.6-1.4-3-2.8-3.9-1.4-.9-3.1-1.2-4.7-.8C5 1.7 3.5 2.7 2.5 4M1.8 10c.4 1.6 1.4 3 2.8 3.9 1.4.9 3.1 1.2 4.7.8 1.7-.4 3.2-1.4 4.2-2.9" />
                        </svg>
                    </button>
                    <button class="modal-close" id="certDialogClose">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="certificateListContainer">
                    <div class="empty-state">
                        <div class="loading-spinner"></div>
                        <p>Loading certificates...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="certDialogCancel" class="btn">Cancel</button>
                <button id="certDialogSign" class="btn btn-primary" disabled>Sign PDF</button>
            </div>
        </div>
    </div>

    <div id="pinDialog" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="pinDialogTitle">
        <div class="modal message-modal">
            <div class="modal-header">
                <h2 id="pinDialogTitle">Enter PIN</h2>
                <button class="modal-close" id="pinDialogClose">&times;</button>
            </div>
            <div class="modal-body">
                <p id="pinDialogMessage" style="margin-bottom: 1rem; color: var(--text-secondary);"></p>
                <div style="margin-bottom: 1rem;">
                    <label for="pinDialogInput"
                        style="display: block; margin-bottom: 0.5rem; font-weight: 500;">PIN/Password:</label>
                    <input type="password" id="pinDialogInput" class="setting-input" placeholder="Enter your PIN"
                        autocomplete="off" style="width: 100%;">
                </div>
            </div>
            <div class="modal-footer">
                <button id="pinDialogCancel" class="btn">Cancel</button>
                <button id="pinDialogOk" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Message Dialog -->
    <div id="messageDialog" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="messageDialogTitle" aria-describedby="messageDialogContent">
        <div class="modal message-modal">
            <div class="modal-header">
                <h2 id="messageDialogTitle">Message</h2>
                <button class="modal-close" id="messageDialogClose">&times;</button>
            </div>
            <div class="modal-body">
                <div id="messageDialogContent" class="message-content">
                    Message content
                </div>
            </div>
            <div class="modal-footer" id="messageDialogFooter">
                <button id="messageDialogOk" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Signature Placement Overlay -->
    <div id="signaturePlacementOverlay" class="signature-placement-overlay hidden">
        <div class="placement-header">
            <div class="placement-info">
                <h3>Place Your Signature</h3>
                <p>Click and drag on the PDF to draw where you want your signature to appear</p>
            </div>
            <div class="placement-controls">
                <button id="placementCancel" class="btn">Cancel</button>
                <button id="placementConfirm" class="btn btn-primary" disabled>Confirm Position</button>
            </div>
        </div>
        <div id="signatureRectangle" class="signature-rectangle hidden"></div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
        <div class="modal settings-modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="settingsModalClose">&times;</button>
            </div>
            <div class="modal-body settings-body">
                <div class="settings-sidebar">
                    <button class="settings-tab active" data-section="appearance">üé® Appearance</button>
                    <button class="settings-tab" data-section="viewer">üìÑ Viewer</button>
                    <button class="settings-tab" data-section="files">üìÅ Files</button>
                    <button class="settings-tab" data-section="signatures">‚úçÔ∏è Signatures</button>
                    <button class="settings-tab" data-section="certificates">üîê Certificates</button>
                    <button class="settings-tab" data-section="shortcuts">‚å®Ô∏è Shortcuts</button>
                    <button class="settings-tab" data-section="advanced">üîß Advanced</button>
                </div>
                <div class="settings-content">
                    <!-- Appearance Settings -->
                    <div class="settings-section active" id="appearanceSection">
                        <h3 class="settings-section-title">Appearance</h3>
                        <p class="settings-section-description">Customize the look and feel of the application</p>

                        <div class="setting-group">
                            <label class="setting-label" for="settingTheme">Theme</label>
                            <select id="settingTheme" class="setting-input">
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                                <option value="auto">Auto (System)</option>
                            </select>
                            <p class="setting-hint">Choose your preferred color scheme</p>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label" for="settingAccentColor">Accent Color</label>
                            <input type="color" id="settingAccentColor" class="setting-input setting-input-color"
                                value="#007acc">
                            <p class="setting-hint">Primary highlight color for buttons and interactive elements</p>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label" for="settingSecondaryAccent">Theme Palette</label>
                            <select id="settingSecondaryAccent" class="setting-input">
                                <option value="neutral">Neutral (Blue-Gray)</option>
                                <option value="slate">Slate (Cool Gray)</option>
                                <option value="purple">Purple</option>
                                <option value="green">Green</option>
                                <option value="orange">Orange</option>
                                <option value="red">Red</option>
                            </select>
                            <p class="setting-hint">Base color palette for backgrounds and surfaces</p>
                        </div>
                    </div>

                    <!-- Viewer Settings -->
                    <div class="settings-section" id="viewerSection">
                        <h3 class="settings-section-title">Viewer</h3>
                        <p class="settings-section-description">Configure how PDFs are displayed</p>

                        <div class="setting-group">
                            <label class="setting-label" for="settingDefaultZoom">Default Zoom Level</label>
                            <div class="setting-input-group">
                                <input type="number" id="settingDefaultZoom" class="setting-input setting-input-number"
                                    min="10" max="400" value="100" step="10">
                                <span class="setting-unit">%</span>
                            </div>
                            <p class="setting-hint">Initial zoom level when opening PDFs (10-400%)</p>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label-inline">
                                <input type="checkbox" id="settingShowLeftSidebar" class="setting-checkbox" checked>
                                <span>Show Left Sidebar by Default</span>
                            </label>
                            <p class="setting-hint">Display pages/index/comments sidebar on startup</p>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label-inline">
                                <input type="checkbox" id="settingShowRightSidebar" class="setting-checkbox">
                                <span>Show Right Sidebar by Default</span>
                            </label>
                            <p class="setting-hint">Display properties panel on startup</p>
                        </div>
                    </div>

                    <!-- Files Settings -->
                    <div class="settings-section" id="filesSection">
                        <h3 class="settings-section-title">Files</h3>
                        <p class="settings-section-description">Manage file handling and history</p>

                        <div class="setting-group">
                            <label class="setting-label" for="settingRecentFilesLength">Recent Files List Length</label>
                            <div class="setting-input-group">
                                <input type="number" id="settingRecentFilesLength"
                                    class="setting-input setting-input-number" min="0" max="50" value="10">
                                <span class="setting-unit">files</span>
                            </div>
                            <p class="setting-hint">Number of recent files to display (0-50)</p>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label" for="settingAutosaveInterval">Auto-save Interval</label>
                            <div class="setting-input-group">
                                <input type="number" id="settingAutosaveInterval"
                                    class="setting-input setting-input-number" min="0" max="600" value="0">
                                <span class="setting-unit">seconds</span>
                            </div>
                            <p class="setting-hint">Automatically save changes (0 = disabled)</p>
                        </div>
                    </div>

                    <!-- Signatures Settings -->
                    <div class="settings-section" id="signaturesSection">
                        <h3 class="settings-section-title">Signature Profiles</h3>
                        <p class="settings-section-description">Manage your signature profiles for signing PDFs</p>

                        <div class="setting-group">
                            <div class="flex justify-between items-center mb-4">
                                <label class="setting-label m-0">Your Profiles</label>
                                <button id="addProfileBtn" class="btn btn-primary btn-small">
                                    <span class="text-lg leading-none">+</span> New Profile
                                </button>
                            </div>
                            <div id="signatureProfilesList" class="signature-profiles-list">
                                <div class="empty-state">
                                    <div class="loading-spinner"></div>
                                    <p>Loading profiles...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Certificates Settings -->
                    <div class="settings-section" id="certificatesSection">
                        <h3 class="settings-section-title">Certificate Sources</h3>
                        <p class="settings-section-description">Configure where to find signing certificates</p>

                        <!-- Certificate Stores -->
                        <div class="setting-group">
                            <div class="flex justify-between items-center mb-4">
                                <label class="setting-label m-0">Certificate Stores</label>
                                <div class="flex gap-2">
                                    <button id="restoreDefaultStoresBtn" class="btn btn-secondary btn-small">
                                        Restore Defaults
                                    </button>
                                    <button id="addCertStoreBtn" class="btn btn-primary btn-small">
                                        <span class="text-lg leading-none">+</span> Add Store
                                    </button>
                                </div>
                            </div>
                            <div id="storesList" class="signature-profiles-list">
                                <div class="empty-state">
                                    <p>Loading...</p>
                                </div>
                            </div>
                            <p class="setting-hint">Directories containing certificates. Click "Save" below to apply changes.</p>
                        </div>

                        <!-- PKCS#11 Libraries -->
                        <div class="setting-group">
                            <div class="flex justify-between items-center mb-4">
                                <label class="setting-label m-0">PKCS#11 Token Libraries</label>
                                <div class="flex gap-2">
                                    <button id="restoreDefaultLibsBtn" class="btn btn-secondary btn-small">
                                        Restore Defaults
                                    </button>
                                    <button id="addTokenLibBtn" class="btn btn-primary btn-small">
                                        <span class="text-lg leading-none">+</span> Add Library
                                    </button>
                                </div>
                            </div>
                            <div id="librariesList" class="signature-profiles-list">
                                <div class="empty-state">
                                    <p>Loading...</p>
                                </div>
                            </div>
                            <p class="setting-hint">Shared libraries (.so/.dll) for hardware security tokens. Click "Save" below to apply changes.</p>
                        </div>

                        <!-- Detected Certificates -->
                        <div class="setting-group">
                            <div class="flex justify-between items-center mb-4">
                                <label class="setting-label m-0">Detected Certificates</label>
                                <button id="refreshCertsBtn" class="btn btn-secondary btn-small">
                                    <span>üîÑ</span> Refresh
                                </button>
                            </div>
                            <div id="certificatesList" class="cert-table-wrapper">
                                <div class="empty-state">
                                    <div class="loading-spinner-small hidden" id="certsLoadingSpinner"></div>
                                    <p id="certsLoadingText">Click refresh to scan for certificates</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shortcuts Settings -->
                    <div class="settings-section" id="shortcutsSection">
                        <h3 class="settings-section-title">Keyboard Shortcuts</h3>
                        <p class="settings-section-description">Customize keyboard shortcuts for common actions</p>

                        <div class="setting-group">
                            <p class="setting-hint mb-4">Click on any shortcut field to set a new key combination. Use
                                modifiers like Control, Alt, Shift with letters or special keys.</p>

                            <div class="shortcuts-list">
                                <div class="shortcut-item">
                                    <label class="setting-label" for="settingShortcutOpenFile">Open File</label>
                                    <input type="text" id="settingShortcutOpenFile" class="setting-input shortcut-input"
                                        placeholder="Control+o" readonly>
                                </div>

                                <div class="shortcut-item">
                                    <label class="setting-label" for="settingShortcutSign">Sign Document</label>
                                    <input type="text" id="settingShortcutSign" class="setting-input shortcut-input"
                                        placeholder="Alt+s" readonly>
                                </div>

                                <div class="shortcut-item">
                                    <label class="setting-label" for="settingShortcutZoomIn">Zoom In</label>
                                    <input type="text" id="settingShortcutZoomIn" class="setting-input shortcut-input"
                                        placeholder="Control+Plus" readonly>
                                </div>

                                <div class="shortcut-item">
                                    <label class="setting-label" for="settingShortcutZoomOut">Zoom Out</label>
                                    <input type="text" id="settingShortcutZoomOut" class="setting-input shortcut-input"
                                        placeholder="Control+Minus" readonly>
                                </div>

                                <div class="shortcut-item">
                                    <label class="setting-label" for="settingShortcutNextTab">Next Tab</label>
                                    <input type="text" id="settingShortcutNextTab" class="setting-input shortcut-input"
                                        placeholder="Control+Tab" readonly>
                                </div>
                            </div>

                            <p class="setting-hint mt-4">
                                <strong>Note:</strong> Escape key is reserved for closing modals and cannot be changed.
                            </p>
                        </div>
                    </div>

                    <!-- Advanced Settings -->
                    <div class="settings-section" id="advancedSection">
                        <h3 class="settings-section-title">Advanced</h3>
                        <p class="settings-section-description">Advanced configuration options</p>

                        <div class="setting-group">
                            <label class="setting-label-inline">
                                <input type="checkbox" id="settingDebugMode" class="setting-checkbox">
                                <span>Enable Debug Mode</span>
                            </label>
                            <p class="setting-hint">Show additional debugging information in the console</p>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label-inline">
                                <input type="checkbox" id="settingHardwareAccel" class="setting-checkbox" checked>
                                <span>Hardware Acceleration</span>
                            </label>
                            <p class="setting-hint">Use GPU acceleration for rendering (recommended)</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="settingsCancel" class="btn">Cancel</button>
                <button id="settingsSave" class="btn btn-primary">Save Settings</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>

    <!-- Profile Editor Modal -->
    <div id="profileEditorModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="profileEditorTitle">
        <div class="modal settings-modal">
            <div class="modal-header">
                <h2 id="profileEditorTitle">Create Signature Profile</h2>
                <button class="modal-close" id="profileEditorClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-editor-container">
                    <div class="profile-editor-form">
                        <div class="setting-group">
                            <label for="profileName">Profile Name <span
                                    style="color: var(--error-red);">*</span></label>
                            <input type="text" id="profileName" class="setting-input"
                                placeholder="e.g., My Visible Signature" required>
                        </div>

                        <div class="setting-group">
                            <label for="profileDescription">Description</label>
                            <textarea id="profileDescription" class="setting-input" placeholder="Optional description"
                                rows="2"></textarea>
                        </div>

                        <div class="setting-group">
                            <label for="profileVisibility">Signature Type <span
                                    style="color: var(--error-red);">*</span></label>
                            <select id="profileVisibility" class="setting-input">
                                <option value="invisible">Invisible - Digital signature only, no visual mark</option>
                                <option value="visible">Visible - Shows signature information on the PDF</option>
                            </select>
                        </div>

                        <div id="visibleProfileSettings" class="visible-profile-settings hidden">
                            <h4
                                style="margin: 1.5rem 0 1rem 0; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
                                Signature Appearance</h4>

                            <div class="setting-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="profileShowSignerName" class="setting-checkbox" checked>
                                    Include certificate subject (signer name)
                                </label>
                            </div>

                            <div class="setting-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="profileShowSigningTime" class="setting-checkbox" checked>
                                    Include timestamp (local time)
                                </label>
                            </div>

                            <div class="setting-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="profileShowLocation" class="setting-checkbox">
                                    Include signing location (based on IP geolocation)
                                </label>
                                <div style="font-size: 0.75rem; color: #f59e0b; margin-top: 0.25rem; padding: 0.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 4px;">
                                    ‚ö† Privacy Notice: Enabling this feature will send your IP address to a third-party geolocation service to determine your signing location. This information will be embedded in the PDF signature.
                                </div>
                            </div>

                            <div class="setting-group">
                                <label for="profileCustomText">Custom Text</label>
                                <textarea id="profileCustomText" class="setting-input"
                                    placeholder="Optional custom text to display on signature" rows="3"></textarea>
                            </div>

                            <div class="setting-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="profileShowIcon" class="setting-checkbox">
                                    Include icon in signature
                                </label>
                            </div>

                            <div id="profileIconSettings" class="hidden">
                                <div class="setting-group">
                                    <label for="profileIconFile">Select Icon</label>
                                    <input type="file" id="profileIconFile" accept="image/*" class="setting-input"
                                        style="padding: 0.5rem;">
                                    <p class="setting-hint" style="margin-top: 0.25rem;">Supported formats: PNG, JPG,
                                        SVG (max 2MB)</p>
                                </div>

                                <div class="setting-group">
                                    <label for="profileIconPosition">Icon Position</label>
                                    <select id="profileIconPosition" class="setting-input">
                                        <option value="left">Left of text</option>
                                        <option value="top">Above text</option>
                                    </select>
                                </div>
                            </div>

                            <div class="setting-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="profileDefinePosition" class="setting-checkbox">
                                    Define signature position
                                </label>
                            </div>

                            <div id="profilePositionSettings" class="hidden">
                                <div class="setting-group">
                                    <label for="profilePage">Default Page</label>
                                    <select id="profilePage" class="setting-input">
                                        <option value="0">Last Page</option>
                                        <option value="1">First Page</option>
                                    </select>
                                </div>

                                <div class="setting-group">
                                    <label>Default Position & Size</label>
                                    <p class="setting-hint" style="margin-bottom: 0.5rem;">These are defaults - you can
                                        adjust when signing</p>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                        <div>
                                            <label style="font-size: 0.875rem;">X Position (pts)</label>
                                            <input type="number" id="profileX" class="setting-input" value="360"
                                                min="0">
                                        </div>
                                        <div>
                                            <label style="font-size: 0.875rem;">Y Position (pts)</label>
                                            <input type="number" id="profileY" class="setting-input" value="50" min="0">
                                        </div>
                                        <div>
                                            <label style="font-size: 0.875rem;">Width (pts)</label>
                                            <input type="number" id="profileWidth" class="setting-input" value="200"
                                                min="50">
                                        </div>
                                        <div>
                                            <label style="font-size: 0.875rem;">Height (pts)</label>
                                            <input type="number" id="profileHeight" class="setting-input" value="80"
                                                min="30">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="profileIsDefault" class="setting-checkbox">
                                Set as default profile
                            </label>
                        </div>
                    </div>

                    <div class="profile-preview-container" id="profilePreviewContainer">
                        <h4
                            style="margin: 0 0 1rem 0; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">
                            Preview</h4>
                        <div class="signature-preview" id="signaturePreview">
                            <div class="preview-empty">
                                Select "Visible" signature type to see preview
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="profileEditorCancel" class="btn">Cancel</button>
                <button id="profileEditorSave" class="btn btn-primary">Save Profile</button>
            </div>
        </div>
    </div>

    <!-- Shortcut capture modal -->
    <div id="shortcutCaptureModal" class="modal-overlay hidden">
        <div class="modal shortcut-capture-modal">
            <div class="modal-header">
                <h2>Set Shortcut</h2>
                <button class="modal-close" id="shortcutCaptureClose">&times;</button>
            </div>
            <div class="modal-body">
                <p>Press the new keyboard combination you want to assign.</p>
                <div id="shortcutCaptureAction"
                    style="font-size:0.95rem; color:var(--accent-blue); margin-top:0.25rem; text-align:center;"></div>
                <div id="shortcutCaptureDisplay"
                    style="font-weight:600; font-size:1.1rem; padding:0.5rem; border:1px dashed var(--accent-blue); margin-top:0.5rem; text-align:center;">
                    Waiting for input...</div>
            </div>
            <div class="modal-footer">
                <button id="shortcutCaptureCancel" class="btn">Cancel</button>
                <button id="shortcutCaptureOk" class="btn btn-primary" disabled>OK</button>
            </div>
        </div>
    </div>
</body>

</html>