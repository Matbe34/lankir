<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Editor Pro</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <header class="toolbar">
            <div class="toolbar-left">
                <button id="openBtn" class="btn btn-primary">
                    <span>üìÇ</span> Open PDF
                </button>
                <button id="settingsBtn" class="btn">
                    <span>‚öôÔ∏è</span> Settings
                </button>
            </div>
            <div class="toolbar-center">
                <h1>PDF Editor Pro</h1>
            </div>
            <div class="toolbar-right">
                <button id="signBtn" class="btn btn-accent" disabled>
                    <span>üîí</span> Sign
                </button>
            </div>
        </header>

        <div class="pdf-tabs-container has-tabs" id="pdfTabsContainer">
            <div class="pdf-tab active" id="homeTab">
                <span class="pdf-tab-name">üè† Home</span>
            </div>
            <!-- PDF tabs will be dynamically added here -->
        </div>

        <main class="main-content">
            <div class="sidebar left-sidebar" id="leftSidebar">
                <div class="sidebar-header">
                    <div class="sidebar-tabs">
                        <button class="tab-btn active" data-tab="pages">Pages</button>
                        <button class="tab-btn" data-tab="index">Index</button>
                        <button class="tab-btn" data-tab="comments">Comments</button>
                    </div>
                    <button class="collapse-btn" id="collapseLeft" title="Hide sidebar">&lt;</button>
                </div>
                
                <div class="tab-content active" id="pagesTab">
                    <div id="pageList" class="page-list">
                        <div class="empty-state">
                            <p>No PDF loaded</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="indexTab">
                    <div class="index-content">
                        <div class="empty-state">
                            <p>No index available</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="commentsTab">
                    <div class="comments-content">
                        <div class="empty-state">
                            <p>No comments yet</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="expand-btn left-expand-btn hidden" id="expandLeft" title="Show sidebar">&gt;</button>

            <div class="viewer">
                <div id="pdfViewer" class="pdf-viewer">
                    <div class="welcome-screen">
                        <div class="welcome-content">
                            <h2>Welcome to PDF Editor Pro</h2>
                            <p>A modern, high-performance PDF editor for Linux</p>
                            <button class="btn btn-large btn-primary" id="welcomeOpenBtn">
                                üìÇ Open a PDF File
                            </button>
                            
                            <div class="recent-files-welcome" id="recentFilesWelcome">
                                <h3>Recent Files</h3>
                                <div id="recentFilesGrid" class="recent-files-grid">
                                    <div class="empty-state">
                                        <p>No recent files</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="expand-btn right-expand-btn hidden" id="expandRight" title="Show properties">&lt;</button>

            <div class="properties-panel right-sidebar" id="rightSidebar">
                <div class="properties-header sidebar-header">
                    <h3>Properties</h3>
                    <button class="collapse-btn" id="collapseRight" title="Hide properties">&gt;</button>
                </div>
                <div id="properties" class="properties-content">
                    <div class="property-group">
                        <label>File:</label>
                        <span id="fileName">-</span>
                    </div>
                    <div class="property-group">
                        <label>Pages:</label>
                        <span id="pageCount">-</span>
                    </div>
                    
                    <!-- Signature Information -->
                    <div class="property-section">
                        <h4 class="property-section-title">Digital Signatures</h4>
                        <div id="signatureInfo" class="signature-info">
                            <div class="empty-state">
                                <p>No signature information</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="statusbar">
            <div class="status-left">
                <span id="statusText">Ready</span>
            </div>
            <div class="status-center">
                <span id="pageIndicator">-</span>
                <span class="status-separator">‚Ä¢</span>
                <span id="scrollProgress">-</span>
            </div>
            <div class="status-right">
                <button id="zoomOutBtn" class="btn-zoom" title="Zoom out">-</button>
                <input type="text" id="zoomInput" class="zoom-input" value="100">
                <span class="zoom-percent">%</span>
                <button id="zoomInBtn" class="btn-zoom" title="Zoom in">+</button>
            </div>
        </footer>
    </div>

    <!-- Profile Selection Dialog -->
    <div id="profileDialog" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2>Choose Signature Type</h2>
                <button class="modal-close" id="profileDialogClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-selection-section">
                    <label for="profileSelectMain">Signature Profile:</label>
                    <select id="profileSelectMain" class="profile-select">
                        <option value="">Loading...</option>
                    </select>
                    <p id="profileDescriptionMain" class="profile-description"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="profileDialogCancel" class="btn">Cancel</button>
                <button id="profileDialogNext" class="btn btn-primary">Next</button>
            </div>
        </div>
    </div>

    <!-- Certificate Selection Dialog -->
    <div id="certDialog" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2>Select Certificate for Signing</h2>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button class="modal-refresh" id="certDialogRefresh" title="Refresh certificate list">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2v4h-4M2 14v-4h4M14.2 6c-.4-1.6-1.4-3-2.8-3.9-1.4-.9-3.1-1.2-4.7-.8C5 1.7 3.5 2.7 2.5 4M1.8 10c.4 1.6 1.4 3 2.8 3.9 1.4.9 3.1 1.2 4.7.8 1.7-.4 3.2-1.4 4.2-2.9"/>
                        </svg>
                    </button>
                    <button class="modal-close" id="certDialogClose">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="certificateListContainer">
                    <div class="empty-state">
                        <div class="loading-spinner"></div>
                        <p>Loading certificates...</p>
                    </div>
                </div>
                <div id="pinInputSection" class="pin-input-section hidden">
                    <label for="pinInput">Enter PIN for the certificate:</label>
                    <input type="password" id="pinInput" placeholder="Enter PIN" autocomplete="off">
                    <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Your PIN is required to access the private key for signing.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="certDialogCancel" class="btn">Cancel</button>
                <button id="certDialogSign" class="btn btn-primary" disabled>Sign PDF</button>
            </div>
        </div>
    </div>

    <!-- Message Dialog -->
    <div id="messageDialog" class="modal-overlay hidden">
        <div class="modal message-modal">
            <div class="modal-header">
                <h2 id="messageDialogTitle">Message</h2>
                <button class="modal-close" id="messageDialogClose">&times;</button>
            </div>
            <div class="modal-body">
                <div id="messageDialogContent" class="message-content">
                    Message content
                </div>
            </div>
            <div class="modal-footer" id="messageDialogFooter">
                <button id="messageDialogOk" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Signature Placement Overlay -->
    <div id="signaturePlacementOverlay" class="signature-placement-overlay hidden">
        <div class="placement-header">
            <div class="placement-info">
                <h3>Place Your Signature</h3>
                <p>Click and drag on the PDF to draw where you want your signature to appear</p>
            </div>
            <div class="placement-controls">
                <button id="placementCancel" class="btn">Cancel</button>
                <button id="placementConfirm" class="btn btn-primary" disabled>Confirm Position</button>
            </div>
        </div>
        <div id="signatureRectangle" class="signature-rectangle hidden"></div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal settings-modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="settingsModalClose">&times;</button>
            </div>
            <div class="modal-body settings-body">
                <div class="settings-sidebar">
                    <button class="settings-tab active" data-section="appearance">üé® Appearance</button>
                    <button class="settings-tab" data-section="viewer">üìÑ Viewer</button>
                    <button class="settings-tab" data-section="files">üìÅ Files</button>
                    <button class="settings-tab" data-section="signatures">‚úçÔ∏è Signatures</button>
                    <button class="settings-tab" data-section="certificates">üîê Certificates</button>
                    <button class="settings-tab" data-section="shortcuts">‚å®Ô∏è Shortcuts</button>
                    <button class="settings-tab" data-section="advanced">üîß Advanced</button>
                </div>
                <div class="settings-content">
                    <!-- Appearance Settings -->
                    <div class="settings-section active" id="appearanceSection">
                        <h3>Appearance</h3>
                        <div class="setting-group">
                            <label>Theme</label>
                            <select id="settingTheme" class="setting-input">
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label>Accent Color</label>
                            <input type="color" id="settingAccentColor" class="setting-input" value="#007acc">
                        </div>
                    </div>

                    <!-- Viewer Settings -->
                    <div class="settings-section" id="viewerSection">
                        <h3>Viewer</h3>
                        <div class="setting-group">
                            <label>Default Zoom Level</label>
                            <input type="number" id="settingDefaultZoom" class="setting-input" min="10" max="400" value="100" step="10">
                            <span class="setting-hint">%</span>
                        </div>
                        <div class="setting-group">
                            <label>Show Left Sidebar by Default</label>
                            <input type="checkbox" id="settingShowLeftSidebar" class="setting-checkbox" checked>
                        </div>
                        <div class="setting-group">
                            <label>Show Right Sidebar by Default</label>
                            <input type="checkbox" id="settingShowRightSidebar" class="setting-checkbox">
                        </div>
                    </div>

                    <!-- Files Settings -->
                    <div class="settings-section" id="filesSection">
                        <h3>Files</h3>
                        <div class="setting-group">
                            <label>Recent Files List Length</label>
                            <input type="number" id="settingRecentFilesLength" class="setting-input" min="0" max="50" value="10">
                        </div>
                        <div class="setting-group">
                            <label>Auto-save Interval</label>
                            <input type="number" id="settingAutosaveInterval" class="setting-input" min="0" max="600" value="0">
                            <span class="setting-hint">seconds (0 = disabled)</span>
                        </div>
                    </div>

                    <!-- Signatures Settings -->
                    <div class="settings-section" id="signaturesSection">
                        <h3>Signature Profiles</h3>
                        <p class="setting-hint">Manage your signature profiles for signing PDFs</p>
                        <div class="setting-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <label style="margin: 0;">Your Profiles</label>
                                <button id="addProfileBtn" class="btn btn-primary" style="padding: 0.4rem 0.8rem;">
                                    <span style="font-size: 1.2rem;">+</span> New Profile
                                </button>
                            </div>
                            <div id="signatureProfilesList" class="signature-profiles-list">
                                <div class="empty-state">
                                    <div class="loading-spinner"></div>
                                    <p>Loading profiles...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Certificates Settings -->
                    <div class="settings-section" id="certificatesSection">
                        <h3>Certificates</h3>
                        <div class="setting-group">
                            <label>Certificate Stores</label>
                            <div id="certificateStoresList">
                                <p class="setting-hint">Configure certificate store locations</p>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>PKCS#11 Token Libraries</label>
                            <div id="tokenLibrariesList">
                                <p class="setting-hint">Configure PKCS#11 library paths</p>
                            </div>
                        </div>
                    </div>

                    <!-- Shortcuts Settings -->
                    <div class="settings-section" id="shortcutsSection">
                        <h3>Keyboard Shortcuts</h3>
                        <div class="setting-group">
                            <p class="setting-hint">Customize keyboard shortcuts (use modifiers like Control, Alt, Shift and a key, e.g. <code>Control+o</code>, <code>Alt+s</code>, <code>Control+Plus</code>)</p>
                            <div class="shortcuts-form">
                                <label>Open File</label>
                                <input type="text" id="settingShortcutOpenFile" class="setting-input" placeholder="Control+o">

                                <label>Sign Document</label>
                                <input type="text" id="settingShortcutSign" class="setting-input" placeholder="Alt+s">

                                <label>Zoom In</label>
                                <input type="text" id="settingShortcutZoomIn" class="setting-input" placeholder="Control+Plus">

                                <label>Zoom Out</label>
                                <input type="text" id="settingShortcutZoomOut" class="setting-input" placeholder="Control+Minus">

                                <label>Next Tab</label>
                                <input type="text" id="settingShortcutNextTab" class="setting-input" placeholder="Control+Tab">

                                <!-- Escape is a reserved key and cannot be modified. It always closes the current modal. -->
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Settings -->
                    <div class="settings-section" id="advancedSection">
                        <h3>Advanced</h3>
                        <div class="setting-group">
                            <label>Enable Debug Mode</label>
                            <input type="checkbox" id="settingDebugMode" class="setting-checkbox">
                        </div>
                        <div class="setting-group">
                            <label>Hardware Acceleration</label>
                            <input type="checkbox" id="settingHardwareAccel" class="setting-checkbox" checked>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="settingsCancel" class="btn">Cancel</button>
                <button id="settingsSave" class="btn btn-primary">Save Settings</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>

    <!-- Profile Editor Modal -->
    <div id="profileEditorModal" class="modal-overlay hidden">
        <div class="modal settings-modal">
            <div class="modal-header">
                <h2 id="profileEditorTitle">Create Signature Profile</h2>
                <button class="modal-close" id="profileEditorClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-editor-container">
                    <div class="profile-editor-form">
                    <div class="setting-group">
                        <label for="profileName">Profile Name <span style="color: var(--error-red);">*</span></label>
                        <input type="text" id="profileName" class="setting-input" placeholder="e.g., My Visible Signature" required>
                    </div>

                    <div class="setting-group">
                        <label for="profileDescription">Description</label>
                        <textarea id="profileDescription" class="setting-input" placeholder="Optional description" rows="2"></textarea>
                    </div>

                    <div class="setting-group">
                        <label for="profileVisibility">Signature Type <span style="color: var(--error-red);">*</span></label>
                        <select id="profileVisibility" class="setting-input">
                            <option value="invisible">Invisible - Digital signature only, no visual mark</option>
                            <option value="visible">Visible - Shows signature information on the PDF</option>
                        </select>
                    </div>

                    <div id="visibleProfileSettings" class="visible-profile-settings hidden">
                        <h4 style="margin: 1.5rem 0 1rem 0; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">Signature Appearance</h4>

                        <div class="setting-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="profileShowSignerName" class="setting-checkbox" checked>
                                Include certificate subject (signer name)
                            </label>
                        </div>

                        <div class="setting-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="profileShowSigningTime" class="setting-checkbox" checked>
                                Include timestamp (local time)
                            </label>
                        </div>

                        <div class="setting-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="profileShowLocation" class="setting-checkbox">
                                Include signing location (based on IP geolocation)
                            </label>
                        </div>

                        <div class="setting-group">
                            <label for="profileCustomText">Custom Text</label>
                            <textarea id="profileCustomText" class="setting-input" placeholder="Optional custom text to display on signature" rows="3"></textarea>
                        </div>

                        <div class="setting-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="profileShowIcon" class="setting-checkbox">
                                Include icon in signature
                            </label>
                        </div>

                        <div id="profileIconSettings" class="hidden">
                            <div class="setting-group">
                                <label for="profileIconFile">Select Icon</label>
                                <input type="file" id="profileIconFile" accept="image/*" class="setting-input" style="padding: 0.5rem;">
                                <p class="setting-hint" style="margin-top: 0.25rem;">Supported formats: PNG, JPG, SVG (max 2MB)</p>
                            </div>

                            <div class="setting-group">
                                <label for="profileIconPosition">Icon Position</label>
                                <select id="profileIconPosition" class="setting-input">
                                    <option value="left">Left of text</option>
                                    <option value="top">Above text</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-group">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="profileDefinePosition" class="setting-checkbox">
                                Define signature position
                            </label>
                        </div>

                        <div id="profilePositionSettings" class="hidden">
                            <div class="setting-group">
                                <label for="profilePage">Default Page</label>
                                <select id="profilePage" class="setting-input">
                                    <option value="0">Last Page</option>
                                    <option value="1">First Page</option>
                                </select>
                            </div>

                            <div class="setting-group">
                                <label>Default Position & Size</label>
                                <p class="setting-hint" style="margin-bottom: 0.5rem;">These are defaults - you can adjust when signing</p>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <div>
                                        <label style="font-size: 0.875rem;">X Position (pts)</label>
                                        <input type="number" id="profileX" class="setting-input" value="360" min="0">
                                    </div>
                                    <div>
                                        <label style="font-size: 0.875rem;">Y Position (pts)</label>
                                        <input type="number" id="profileY" class="setting-input" value="50" min="0">
                                    </div>
                                    <div>
                                        <label style="font-size: 0.875rem;">Width (pts)</label>
                                        <input type="number" id="profileWidth" class="setting-input" value="200" min="50">
                                    </div>
                                    <div>
                                        <label style="font-size: 0.875rem;">Height (pts)</label>
                                        <input type="number" id="profileHeight" class="setting-input" value="80" min="30">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="profileIsDefault" class="setting-checkbox">
                            Set as default profile
                        </label>
                    </div>
                </div>

                <div class="profile-preview-container" id="profilePreviewContainer">
                    <h4 style="margin: 0 0 1rem 0; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem;">Preview</h4>
                    <div class="signature-preview" id="signaturePreview">
                        <div class="preview-empty">
                            Select "Visible" signature type to see preview
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div class="modal-footer">
                <button id="profileEditorCancel" class="btn">Cancel</button>
                <button id="profileEditorSave" class="btn btn-primary">Save Profile</button>
            </div>
        </div>
    </div>

    <!-- Shortcut capture modal -->
    <div id="shortcutCaptureModal" class="modal-overlay hidden">
        <div class="modal shortcut-capture-modal">
            <div class="modal-header">
                <h2>Set Shortcut</h2>
                <button class="modal-close" id="shortcutCaptureClose">&times;</button>
            </div>
            <div class="modal-body">
                <p>Press the new keyboard combination you want to assign.</p>
                <div id="shortcutCaptureAction" style="font-size:0.95rem; color:var(--accent-blue); margin-top:0.25rem; text-align:center;"></div>
                <div id="shortcutCaptureDisplay" style="font-weight:600; font-size:1.1rem; padding:0.5rem; border:1px dashed var(--accent-blue); margin-top:0.5rem; text-align:center;">Waiting for input...</div>
            </div>
            <div class="modal-footer">
                <button id="shortcutCaptureCancel" class="btn">Cancel</button>
                <button id="shortcutCaptureOk" class="btn btn-primary" disabled>OK</button>
            </div>
        </div>
    </div>
</body>
</html>

